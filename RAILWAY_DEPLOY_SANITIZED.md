# Railway Deployment Guide (Sanitized)

**Version:** 1.0  
**Last Updated:** 2026-01-09  
**Status:** Production Ready

> **Security Note:** This is a sanitized version. Actual credentials are stored in the team's password manager.

---

## üöÄ **Quick Start Deployment**

### Prerequisites:
- Railway account created
- Railway CLI installed
- Project repository ready
- Team password manager access for credentials

---

## üìã **Deployment Steps**

### 1. **Railway CLI Setup**

```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login
# This will open a browser for authentication

# Verify login
railway whoami
```

### 2. **Create Railway Project**

```bash
# Create new project
railway init

# Or link existing project
railway link
```

### 3. **Add PostgreSQL Database**

```bash
# Add PostgreSQL service
railway add
# Select: PostgreSQL

# Database will be automatically provisioned
# DATABASE_URL will be automatically created
```

### 4. **Configure Environment Variables**

**Required Variables:**

| Variable | Description | How to Obtain |
|----------|-------------|---------------|
| `DATABASE_URL` | PostgreSQL connection | Auto-generated by Railway |
| `JWT_SECRET` | JWT signing secret | Generate with crypto.randomBytes(64) |
| `NEXTAUTH_SECRET` | NextAuth secret | Same as JWT_SECRET |
| `NODE_ENV` | Environment mode | Set to "production" |

**Generate Secrets:**
```bash
# Generate JWT_SECRET (64 bytes = 128 hex characters)
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# Copy output and set in Railway
railway variables --set JWT_SECRET="[generated_secret]"
railway variables --set NEXTAUTH_SECRET="[same_secret]"
railway variables --set NODE_ENV="production"
```

### 5. **Deploy Application**

```bash
# Deploy from current directory
railway up

# Or deploy specific branch
railway up --branch main
```

### 6. **Run Database Migrations**

```bash
# Generate Prisma client
railway run npx prisma generate

# Push schema to database
railway run npx prisma db push

# Or run migrations (if you have migration files)
railway run npx prisma migrate deploy
```

### 7. **Seed Database (Optional)**

```bash
# Run seed script
railway run npm run db:seed

# Note: Seed creates test users
# Credentials are stored in password manager
```

### 8. **Generate Public Domain**

```bash
# Generate domain
railway domain

# Or through dashboard:
# Project ‚Üí Service ‚Üí Settings ‚Üí Networking ‚Üí Generate Domain
```

---

## üîç **Verify Deployment**

### Health Check:
```bash
# Check application health
curl https://[your-domain].up.railway.app/api/health

# Expected response:
# {"status":"healthy","database":"connected"}
```

### Test Authentication:
```bash
# Get test credentials from password manager
# Reference: "PoimenSoft/Railway/TestUsers"

# Test login endpoint
curl -X POST https://[your-domain].up.railway.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"[test-email]","password":"[test-password]"}'
```

---

## üìä **Monitoring**

### View Logs:
```bash
# Real-time logs
railway logs

# Filtered logs
railway logs --lines 100

# Build logs
railway logs --deployment [deployment-id]
```

### Check Status:
```bash
# Project status
railway status

# Service status
railway service

# List deployments
railway deployments
```

---

## üîê **Security Best Practices**

### Credentials Management:
1. ‚úÖ **Never commit credentials** to repository
2. ‚úÖ **Use password manager** for team credential storage
3. ‚úÖ **Rotate secrets regularly** (quarterly minimum)
4. ‚úÖ **Use strong passwords** (16+ characters, random)
5. ‚úÖ **Enable 2FA** on Railway account

### Environment Variables:
1. ‚úÖ Store all secrets in Railway Variables
2. ‚úÖ Never log sensitive values
3. ‚úÖ Use different secrets for dev/staging/prod
4. ‚úÖ Document required variables in README

### Database Security:
1. ‚úÖ Use Railway's internal DATABASE_URL
2. ‚úÖ Disable public database access if not needed
3. ‚úÖ Regular backups (Railway automatic backups enabled)
4. ‚úÖ Monitor for unusual query patterns

---

## üõ†Ô∏è **Common Operations**

### Update Application:
```bash
# Push changes
git push origin main

# Railway auto-deploys on push
# Or manual deploy:
railway up
```

### Rollback Deployment:
```bash
# List recent deployments
railway deployments

# Rollback to specific deployment
railway rollback [deployment-id]
```

### Database Operations:
```bash
# Open Prisma Studio
railway run npx prisma studio

# Run database command
railway run npx prisma db [command]

# Export database
railway run pg_dump > backup.sql
```

### Environment Management:
```bash
# List variables
railway variables

# Set variable
railway variables --set KEY=VALUE

# Delete variable
railway variables --unset KEY
```

---

## üìù **Configuration Files**

### railway.json:
```json
{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "NIXPACKS",
    "buildCommand": "npm run build"
  },
  "deploy": {
    "startCommand": "npm run start",
    "healthcheckPath": "/api/health",
    "healthcheckTimeout": 100,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  }
}
```

### package.json scripts:
```json
{
  "scripts": {
    "build": "next build",
    "start": "next start",
    "db:generate": "prisma generate",
    "db:push": "prisma db push",
    "postinstall": "prisma generate"
  }
}
```

---

## üö® **Troubleshooting**

### Build Fails:
```bash
# Check build logs
railway logs --deployment [id]

# Common issues:
# - Missing environment variables
# - Prisma client not generated
# - Node version mismatch
```

### Database Connection Issues:
```bash
# Verify DATABASE_URL is set
railway variables | grep DATABASE_URL

# Test connection
railway run npx prisma db execute --stdin <<< "SELECT 1"
```

### Health Check Fails:
```bash
# Check application logs
railway logs --lines 100

# Verify health endpoint locally
npm run dev
curl http://localhost:3000/api/health
```

---

## üìö **Additional Resources**

### Documentation:
- [Railway Documentation](https://docs.railway.app)
- [Prisma Documentation](https://www.prisma.io/docs)
- [Next.js Deployment](https://nextjs.org/docs/deployment)

### Internal Resources:
- Password Manager: `1Password/PoimenSoft`
- Team Wiki: Internal documentation portal
- Support: Contact DevOps team

### Railway Dashboard:
- Project URL: `https://railway.app/project/[project-id]`
- Team Dashboard: `https://railway.app/team`

---

## ‚úÖ **Post-Deployment Checklist**

- [ ] Application deployed successfully
- [ ] Health check returning healthy status
- [ ] Database connected and seeded
- [ ] Environment variables configured
- [ ] Public domain generated
- [ ] SSL certificate active (automatic)
- [ ] Test login working
- [ ] Logs showing no errors
- [ ] Team has access to credentials
- [ ] Documentation updated

---

## üîÑ **Maintenance Schedule**

### Weekly:
- Review deployment logs
- Check for security updates
- Monitor resource usage

### Monthly:
- Rotate test user passwords
- Review access logs
- Update dependencies

### Quarterly:
- Rotate JWT secrets
- Security audit
- Performance review
- Backup verification

---

## üìû **Support**

### Issues:
- Check logs first: `railway logs`
- Review troubleshooting section
- Contact DevOps team

### Credentials:
- Access password manager
- Never share via email/chat
- Use secure channels only

### Updates:
- Subscribe to Railway status: status.railway.app
- Join team notifications channel
- Review changelog regularly

---

**For actual deployment credentials and sensitive configuration:**
- **Contact:** DevOps Team Lead
- **Location:** Team Password Manager ‚Üí PoimenSoft ‚Üí Railway
- **Access:** Request via internal ticketing system

**Last Reviewed:** 2026-01-09  
**Next Review:** 2026-04-09  
**Maintained By:** DevOps Team
